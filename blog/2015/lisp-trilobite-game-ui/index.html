<!DOCTYPE html>
<html>
	<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<meta http-equiv="Content-Language" content="en">
<link rel="alternate" hreflang="x-default" href="https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/">
<link rel="alternate" hreflang="en" href="https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/">


  

<link rel="alternate" hreflang="ru" href="https://yrabbit.github.io/ru/blog/2015/lisp-trilobite-game-ui/">



		<!-- Begin Jekyll SEO tag v2.2.4 -->
<meta property="og:title" content="Trilobit Game in Lisp: Interaction with the Player">
<meta name="author" content="Yellow Rabbit">
<meta property="og:locale" content="en">
<meta name="description" content="Interface with the user, show the game board, moves, determine the winner and inform about it.">
<meta property="og:description" content="Interface with the user, show the game board, moves, determine the winner and inform about it.">
<link rel="canonical" href="https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/">
<meta property="og:url" content="https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/">
<meta property="og:site_name" content="Asm, Lisp, and so on - Programmer’s Blog">
<meta property="og:image" content="https://yrabbit.github.io/imgs/post-banners/trilobite-ui.jpeg">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-12-15T13:22:42+10:00">
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Trilobit Game in Lisp: Interaction with the Player","author":{"@type":"Person","name":"Yellow Rabbit"},"image":"https://yrabbit.github.io/imgs/post-banners/trilobite-ui.jpeg","datePublished":"2015-12-15T13:22:42+10:00","dateModified":"2017-07-29T16:08:52+10:00","description":"Interface with the user, show the game board, moves, determine the winner and inform about it.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://yrabbit.github.io/imgs/blog-log.png"},"name":"Yellow Rabbit"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/"},"url":"https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/"}</script>
<!-- End Jekyll SEO tag -->

		<title>Trilobit Game in Lisp: Interaction with the Player | Yellow Rabbit
			
		</title>
		

		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/syntax.css">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="wrapper">
			<header>
				<h2><a href="https://yrabbit.github.io/blog/"><img src="/imgs/blog-logo.png" title="A programmer's blog about experiments with PDP-11 assembler, Lisp, as well as other fun things." alt="Yellow Rabbit" width="300"></a></h2>
				<nav><ul>
						<li><a href="/about/">About</a></li>
						<li><a href="/projects/">Projects</a></li>
					<li><a class="active" href="/blog/">Blog</a></li>
					<li><a href="/contact/">Contact</a></li>
				</ul></nav>
			</header>
			<section>
				

<h1 class="post-title">Trilobit: Begin to Communicate with the Player</h1>
<p class="post-meta">
	15 Dec 2015 •
	6 min. read •
	<a href="#disqus_thread" data-disqus-identifier="2015-12-15-lisp-trilobite-game-ui.md">Comments</a>
</p>


	<div class="post-banner" style="background-image: url(/imgs/post-banners/trilobite-ui.jpeg);">
		<img src="/imgs/post-banners/trilobite-ui.jpeg" alt="Trilobit Game in Lisp: Interaction with the Player">
	</div>


<p>We continue to develop the game described <a href="/blog/2015/lisp-trilobite-game-board/">here</a>, <a href="/blog/2015/lisp-trilobite-moves-victory-check/">here</a> and <a href="/blog/2015/lisp-trilobite-rules-engine/">here</a>.</p>

<h2 id="interface">Interface</h2>
<p>Now the time has come to acquire a small system of interaction with player. First, let’s show the board:</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="c1">;; *** UI</span>
<span class="c1">;; show board</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">draw-board</span> <span class="p">(</span><span class="nv">board</span><span class="p">)</span>
  <span class="p">(</span><span class="k">flet</span>
    <span class="p">((</span><span class="nv">get-cell-char</span> <span class="p">(</span><span class="nv">cell</span><span class="p">)</span>
                    <span class="p">(</span><span class="nb">cond</span>
                      <span class="p">((</span><span class="nb">eql</span> <span class="nv">cell</span> <span class="vg">*ai-cell*</span><span class="p">)</span>    <span class="sc">#\A</span><span class="p">)</span>
                      <span class="p">((</span><span class="nb">eql</span> <span class="nv">cell</span> <span class="vg">*human-cell*</span><span class="p">)</span> <span class="sc">#\H</span><span class="p">)</span>
                      <span class="p">(</span><span class="no">t</span> <span class="sc">#\.</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">loop</span>
      <span class="nv">for</span> <span class="nv">j</span> <span class="nv">below</span> <span class="vg">*board-height*</span>
      <span class="nv">for</span> <span class="nv">row-idx</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">by</span> <span class="vg">*board-width*</span>
      <span class="nb">do</span> <span class="p">(</span><span class="k">progn</span>
           <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">loop</span>
             <span class="nv">for</span> <span class="nv">i</span> <span class="nv">below</span> <span class="vg">*board-width*</span>
             <span class="nv">for</span> <span class="nv">idx</span> <span class="nv">from</span> <span class="nv">row-idx</span>
             <span class="nv">for</span> <span class="nv">cell</span> <span class="nb">=</span> <span class="p">(</span><span class="nv">get-cell</span> <span class="nv">board</span> <span class="nv">idx</span><span class="p">)</span>
             <span class="nb">do</span> <span class="p">(</span><span class="nb">princ</span> <span class="p">(</span><span class="nv">get-cell-char</span> <span class="nv">cell</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">loop</span> 
      <span class="nv">for</span> <span class="nv">i</span> <span class="nv">below</span> <span class="vg">*board-width*</span>
      <span class="nb">do</span> <span class="p">(</span><span class="nb">princ</span> <span class="p">(</span><span class="nb">code-char</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">97</span> <span class="nv">i</span><span class="p">))))))</span>
</code></pre>
</div>
<p>Under the board are printed letters of the columns, we need them to enter the player moves.</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nb">*</span> <span class="p">(</span><span class="nv">draw-board</span> <span class="p">(</span><span class="nv">new-board</span><span class="p">))</span>

<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="nv">abc</span>
</code></pre>
</div>
<p>A small auxiliary function for printing the winner. The winner is <em>not</em> the loser in the current position <img class="emoji" title=":smile:" alt=":smile:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png" height="20" width="20" align="absmiddle"></p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="c1">;; announce winner</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">announce-winner</span> <span class="p">(</span><span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">game-node-failp</span> <span class="nv">tree</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"The winner is ~a"</span>
            <span class="p">(</span><span class="nv">get-player-str</span> <span class="p">(</span><span class="nv">change-player</span> <span class="p">(</span><span class="nv">game-node-player</span> <span class="nv">tree</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">princ</span> <span class="s">"There are no winners."</span><span class="p">)))</span>
</code></pre>
</div>
<p>Completely information about the game situation includes the board and the current active player.</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="c1">;; show situation</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">print-info</span> <span class="p">(</span><span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"current player = ~a"</span> <span class="p">(</span><span class="nv">get-player-str</span> <span class="p">(</span><span class="nv">game-node-player</span> <span class="nv">tree</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">draw-board</span> <span class="p">(</span><span class="nv">game-node-board</span> <span class="nv">tree</span><span class="p">)))</span>
</code></pre>
</div>
<p>Let’s try on the initial board:</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nb">*</span> <span class="p">(</span><span class="nv">print-info</span> <span class="p">(</span><span class="nv">game-tree</span> <span class="p">(</span><span class="nv">new-board</span><span class="p">)</span> <span class="vg">*ai-player*</span> <span class="mi">-1</span><span class="p">))</span>

<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="nv">abc</span>
<span class="nv">NIL</span>
<span class="nb">*</span>
</code></pre>
</div>
<p>The processing of the player’s move is simple: it is suggested to enter a number corresponding to the letter designation of the column. Filled columns are not offered for selection. The correctness of the data is no checked, but for our purposes this is not critical.</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="c1">;; handle human</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">handle-human</span> <span class="p">(</span><span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">princ</span> <span class="s">"choose your move:"</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">moves</span> <span class="p">(</span><span class="nv">game-node-moves</span> <span class="nv">tree</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">labels</span> <span class="p">((</span><span class="nv">print-moves</span> <span class="p">(</span><span class="nv">lst</span> <span class="nv">n</span><span class="p">)</span> 
                          <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">lst</span><span class="p">)</span>
                            <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">move</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">))</span>
                                   <span class="p">(</span><span class="nv">action</span> <span class="p">(</span><span class="nb">code-char</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">97</span> <span class="p">(</span><span class="nb">mod</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">move</span><span class="p">)</span> <span class="vg">*board-width*</span><span class="p">)))))</span>
                              <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
                              <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">"~a. ~a"</span> <span class="nv">n</span> <span class="nv">action</span><span class="p">)</span>
                              <span class="p">(</span><span class="nv">print-moves</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">)</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">n</span><span class="p">))))))</span>
      <span class="p">(</span><span class="nv">print-moves</span> <span class="nv">moves</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">fresh-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cadr</span> <span class="p">(</span><span class="nb">nth</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">read</span><span class="p">))</span> <span class="nv">moves</span><span class="p">))))</span>
</code></pre>
</div>

<h2 id="main-loop">Main loop</h2>
<p>The most important function of the program. Allows the computer and the player to make move  in turn, checking for victory.</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="c1">;; main loop</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">play</span> <span class="p">(</span><span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">print-info</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">game-node-failp</span> <span class="nv">tree</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">announce-winner</span> <span class="nv">tree</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq</span> <span class="vg">*ai-player*</span> <span class="p">(</span><span class="nv">game-node-player</span> <span class="nv">tree</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">play</span> <span class="p">(</span><span class="nv">handle-computer</span> <span class="nv">tree</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">play</span> <span class="p">(</span><span class="nv">handle-human</span> <span class="nv">tree</span><span class="p">)))))</span>

</code></pre>
</div>
<p>Small party completely:</p>

<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nb">*</span> <span class="p">(</span><span class="nv">play</span> <span class="p">(</span><span class="nv">game-tree</span> <span class="p">(</span><span class="nv">new-board</span><span class="p">)</span> <span class="vg">*ai-player*</span> <span class="mi">-1</span><span class="p">))</span>

<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="nv">abc</span>
<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">Human</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="nv">A..</span>
<span class="nv">abc</span>
<span class="nv">choose</span> <span class="nv">your</span> <span class="nv">move:</span>
<span class="mi">1.</span> <span class="nv">a</span>
<span class="mi">2.</span> <span class="nv">b</span>
<span class="mi">3.</span> <span class="nv">c</span>
<span class="mi">1</span>
</code></pre>
</div>
<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="o">...</span>
<span class="nv">H..</span>
<span class="nv">A..</span>
<span class="nv">abc</span>
<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">Human</span>
<span class="o">...</span>
<span class="nv">H..</span>
<span class="nv">AA.</span>
<span class="nv">abc</span>
<span class="nv">choose</span> <span class="nv">your</span> <span class="nv">move:</span>
<span class="mi">1.</span> <span class="nv">a</span>
<span class="mi">2.</span> <span class="nv">b</span>
<span class="mi">3.</span> <span class="nv">c</span>
<span class="mi">1</span>
</code></pre>
</div>
<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="nv">H..</span>
<span class="nv">H..</span>
<span class="nv">AA.</span>
<span class="nv">abc</span>
<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">Human</span>
<span class="nv">H..</span>
<span class="nv">HA.</span>
<span class="nv">AA.</span>
<span class="nv">abc</span>
<span class="nv">choose</span> <span class="nv">your</span> <span class="nv">move:</span>
<span class="mi">1.</span> <span class="nv">b</span>
<span class="mi">2.</span> <span class="nv">c</span>
<span class="mi">2</span>
</code></pre>
</div>
<div class="language-cl highlighter-rouge">
<pre class="highlight"><code><span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="nv">H..</span>
<span class="nv">HA.</span>
<span class="nv">AAH</span>
<span class="nv">abc</span>
<span class="nv">current</span> <span class="nv">player</span> <span class="nb">=</span> <span class="nv">Human</span>
<span class="nv">HA.</span>
<span class="nv">HA.</span>
<span class="nv">AAH</span>
<span class="nv">abc</span>
<span class="nv">The</span> <span class="nv">winner</span> <span class="nv">is</span> <span class="nv">The</span> <span class="nv">Evil</span> <span class="nv">AI</span>
<span class="nv">NIL</span>
</code></pre>
</div>
<p>The computer won <img class="emoji" title=":frowning:" alt=":frowning:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f626.png" height="20" width="20" align="absmiddle"> Although AI plays quite strange, it still won.</p>



<hr>


<div id="disqus_thread"></div>


			</section>
			<footer>

<img class="avatar" src="https://www.gravatar.com/avatar/1d87b9cdbef9dec8e79613e19c601121?s=144" alt="Me">



				<p>
					<small>© 2017 Yellow Rabbit</small><br>
					<small>Made with <a href="http://jekyllrb.com/">Jekyll</a> — Theme by <a href="https://github.com/orderedlist">orderedlist</a></small>
				</p>
			</footer>
		</div>
		<script src="/js/scale.fix.js"></script>
	

	<script type="text/javascript">
	var disqus_shortname = 'yrabbitblog',
	disqus_identifier = '2015-12-15-lisp-trilobite-game-ui.md-en',
	disqus_url        = 'https://yrabbit.github.io/blog/2015/lisp-trilobite-game-ui/'
	;
	(function() {
		var load = function(src){
			var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = src;
			var e = document.getElementsByTagName('script')[0]; e.parentNode.insertBefore(s, e);
		};
		load('//' + disqus_shortname + '.disqus.com/count.js');
		if (document.getElementById('disqus_thread')) {
			load('//' + disqus_shortname + '.disqus.com/embed.js');
		}
	})();
</script>


	</body>
</html>
